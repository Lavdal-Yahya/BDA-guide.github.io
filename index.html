<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BDA cheat sheet</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Prism CSS -->
    <!-- <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-coy.min.css" rel="stylesheet" /> -->
    <link rel="stylesheet" href="styles.css">
</head>
<body class="min-h-screen">
    <header class="bg-white text-gray-800 py-12">
        <div class="container mx-auto px-4">
			<div id="db-container">
				<img src="database.png" alt="">
			</div>
            <h1 class="text-4xl font-bold gap-2" style="text-align: center;">
                
                BDA cheat sheet
            </h1>
			<p id="email-link"><a href="https://youtu.be/xvFZjo5PgG0" >✉️LavdalYahya@gmail.com</a></p>
        </div>
		<div id="description-container">
			<p id="description">Ce guide résume les concepts essentiels de "Gestion des utilisateurs" et "PL/SQL" pour vous aider à résoudre les exercices du TP Révision BD.</p>
		</div>
	</header>

    <main class="container mx-auto px-4 py-8">
        
			<div id="warning-text">
            <p class="font-bold">⚠️ ATTENTION</p>
            <p>TOUT LES CODE DANS CE DOCUMENT SONT GENERER PAR CHATGPT</p>
		
        </div>

        <!-- Tab Navigation -->
        <div class="flex border-b border-gray-200 mb-8">
            <button 
                class="px-4 py-2 font-medium text-sm border-b-2 border-blue-500 text-blue-600 -mb-px"
                data-tab="users"
            >
                Gestion des Utilisateurs
            </button>
            <button 
                class="px-4 py-2 font-medium text-sm text-gray-500 hover:text-gray-700"
                data-tab="plsql"
            >
                PL/SQL
            </button>
            <button 
                class="px-4 py-2 font-medium text-sm text-gray-500 hover:text-gray-700"
                data-tab="exercises"
            >
                TD Corrigée
            </button>
        </div>

        <!-- Tab Contents -->
        <div id="users" class="tab-content active">
            <h2 class="text-3xl font-bold mb-4">1. Gestion des utilisateurs dans Oracle</h2>
            <!-- Content from the first section goes here -->
            <h3 class="font-bold mt-6 mb-4">Principaux concepts :</h3>
            <ul class="space-y-2 list-disc pl-5">
                <li><strong>Utilisateurs</strong> : Création et gestion des comptes utilisateurs.</li>
                <li><strong>Privilèges</strong> : Autorisations accordées aux utilisateurs (ex: SELECT, INSERT, DELETE).</li>
                <li><strong>Rôles</strong> : Groupes de privilèges pour simplifier la gestion.</li>
                <li><strong>Tablespaces</strong> : Espaces de stockage des objets de la base de données.</li>
                <li><strong>Profils</strong> : Restrictions appliquées aux utilisateurs (ex: durée de vie du mot de passe, tentatives de connexion).</li>
                <li><strong>Dictionnaire de données</strong> : Tables système contenant les métadonnées de la base.</li>
            </ul>

            <h3 class="font-bold mt-8 mb-4">Commandes essentielles :</h3>
            <!-- Rest of the user management content -->
			<ol
			type="1"
			id="19963b52-fd00-8057-a819-c2c1eeb731b6"
			class="space-y-2 list-decimal pl-5
			start="1"
		  >
			<li>
			  <strong>Créer un utilisateur</strong>
			  
			  <pre
			  ><code class="language-SQL">CREATE USER admin1 IDENTIFIED BY 12345;</code></pre>
			</li>
			<li>
			  <strong>Attribuer des privilèges</strong>
			  
			  <pre
			  ><code class="language-SQL">GRANT CREATE TABLE, ALTER ON Client TO admin1;
  GRANT SELECT ON Hotel TO admin1;</code></pre>
			</li>
			<li>
			  <strong>Supprimer des privilèges</strong>
			  
			  <pre
				id="19963b52-fd00-8015-8f31-c5242af5f9f7"
			  ><code class="language-SQL">REVOKE ALL PRIVILEGES FROM admin1;</code></pre>
			</li>
			<li>
			  <strong>Créer un tablespace</strong>

			  <pre
				id="19963b52-fd00-8070-a6a8-cc0a1ffdc19f"
			  ><code class="language-SQL">CREATE TABLESPACE tab_hotel DATAFILE 'tab_hotel.dbf' SIZE 4M;</code></pre>
			</li>
			<li>
			  <strong>Créer un profil avec des restrictions</strong>
			  
			  <pre
				id="19963b52-fd00-80f6-8737-c5f3b651d74c"
			  ><code class="language-SQL">CREATE PROFILE profig1 LIMIT
  FAILED_LOGIN_ATTEMPTS 2
  PASSWORD_LIFE_TIME 60
  SESSIONS_PER_USER 2
  CONNECT_TIME 2;</code></pre>
			</li>
			<li>
			  <strong>Appliquer un profil à un utilisateur</strong>
			  
			  <pre
				id="19963b52-fd00-80c8-a51f-f8a8e744b47d"
			  ><code class="language-SQL">ALTER USER user1 PROFILE profig1;</code></pre>
			</li>
		  </ol>
        </div>

        <div id="plsql" class="tab-content">
            <h2 class="text-3xl font-bold mb-4">2. PL/SQL - Programmation procédurale en SQL</h2>
            <!-- Content from the PL/SQL section goes here -->
			<p id="19963b52-fd00-80bc-a621-d6babce412d6" class="">
				PL/SQL permet d&#x27;automatiser des traitements en base de données.
			  </p>
			  <h3 id="19963b52-fd00-80f2-975d-f5f2d01a919a" class="">
				<strong>Structures de base :</strong>
			  </h3>
			  <ul id="19963b52-fd00-8039-b2d7-ce3a7e7ccd35" class="space-y-2 list-disc pl-5">
				<br><li style="list-style-type: disc">
				  <strong>Blocs PL/SQL</strong>
				 
				  <pre
					id="19963b52-fd00-80d5-bf1e-d6d67bee2bfa"
					class="relative bg-gray-800 rounded-lg p-4 text-white"
				  ><code class="language-SQL">DECLARE
		v_nom VARCHAR2(50);
	  BEGIN
		v_nom := &#x27;John&#x27;;
		DBMS_OUTPUT.PUT_LINE(v_nom);
	  END;</code></pre>
				</li>
			  </ul>
			  <ul id="19963b52-fd00-8015-b32e-e20b6b7cd283" class="space-y-2 list-disc pl-5">
				<br><li style="list-style-type: disc">
				  <strong>Boucles et conditions</strong>
				 
				  <pre
					id="19963b52-fd00-8036-b384-d8b0f9bbfd4b"
					class="relative bg-gray-800 rounded-lg p-4 text-white"
				  ><code class="language-SQL">DECLARE
		i NUMBER := 1;
	  BEGIN
		WHILE i &lt;= 10 LOOP
		  DBMS_OUTPUT.PUT_LINE(i);
		  i := i + 1;
		END LOOP;
	  END;</code></pre>
				</li>
			  </ul>
			  <ul id="19963b52-fd00-80d6-a78e-ffd8860abcce" class="space-y-2 list-disc pl-5">
				<br><li style="list-style-type: disc">
				  <strong>Procédures</strong>
				 
				  <pre
					id="19963b52-fd00-805d-83f6-f6e44b814aba"
					class="relative bg-gray-800 rounded-lg p-4 text-white"
				  ><code class="language-SQL">CREATE PROCEDURE Insert_Client(p_nom VARCHAR2, p_prenom VARCHAR2) AS
	  BEGIN
		INSERT INTO Client (nom, prenom) VALUES (p_nom, p_prenom);
	  END;</code></pre>
				</li>
			  </ul>
			  <ul id="19963b52-fd00-80b8-b3ab-c4392af6af5b" class="space-y-2 list-disc pl-5">
				<br><li style="list-style-type: disc">
				  <strong>Fonctions</strong>
				 
				  <pre
					id="19963b52-fd00-80f4-8dc2-ef702ab15966"
					class="relative bg-gray-800 rounded-lg p-4 text-white"
				  ><code class="language-SQL">CREATE FUNCTION Total_Paiements(p_idClient NUMBER) RETURN NUMBER AS
		total NUMBER;
	  BEGIN
		SELECT SUM(montant) INTO total FROM Paiement WHERE idClient = p_idClient;
		RETURN total;
	  END;</code></pre>
				</li>
			  </ul>
			  <ul id="19963b52-fd00-80fb-8b17-e1c2a3d86009" class="space-y-2 list-disc pl-5">
				<br><li style="list-style-type: disc">
				  <strong>Curseurs (requêtes dynamiques)</strong>
				 
				  <pre
					id="19963b52-fd00-808d-91e1-cf13922cd9ec"
					class="relative bg-gray-800 rounded-lg p-4 text-white"
				  ><code class="language-SQL">DECLARE
		CURSOR c_clients IS SELECT nom FROM Client;
		v_nom Client.nom%TYPE;
	  BEGIN
		OPEN c_clients;
		LOOP
		  FETCH c_clients INTO v_nom;
		  EXIT WHEN c_clients%NOTFOUND;
		  DBMS_OUTPUT.PUT_LINE(v_nom);
		END LOOP;
		CLOSE c_clients;
	  END;</code></pre>
				</li>
			  </ul>
			  <br>
			  <br>
			  <hr id="19963b52-fd00-80f8-9aaa-e1d031d3afde" />
			  <br>
			  <br>
			  <h2 class="text-2xl font-bold mb-4">
				Triggers (Déclencheurs)
			  </h2>
			  <p id="19963b52-fd00-807a-9612-fc840d9b6d73" class="">
				Les <strong>triggers</strong> permettent d&#x27;exécuter des actions
				automatiques en réponse à des modifications des données.
			  </p>
			  <ol
				type="1"
				id="19963b52-fd00-8073-acf3-dddc30407b28"
				class="space-y-2 list-decimal pl-5
				start="1"
			  >
			  <br>
				<li>
				  <strong>Empêcher les mises à jour le week-End</strong>
				 
				  <pre
					id="19963b52-fd00-8027-8417-ea95e828c90f"
					class="relative bg-gray-800 rounded-lg p-4 text-white"
				  ><code class="language-SQL">CREATE OR REPLACE TRIGGER Check_Weekend
	  BEFORE UPDATE ON Reservation
	  FOR EACH ROW
	  BEGIN
		IF TO_CHAR(SYSDATE, &#x27;DY&#x27;) IN (&#x27;SAT&#x27;, &#x27;SUN&#x27;) THEN
		  RAISE_APPLICATION_ERROR(-20001, &#x27;Mise à jour interdite le week-end&#x27;);
		END IF;
	  END;</code></pre>
				</li>
			  </ol>
			  <ol
				type="1"
				id="19963b52-fd00-80bf-b599-cbd5feb8170f"
				class="space-y-2 list-decimal pl-5
				start="2"
			  >
				<br>
				<li>
				  <strong>Mettre à jour le compteur de réservations par hôtel</strong>
				 
				  <pre
					id="19963b52-fd00-80f0-b7d5-ed6d9fb1eaee"
					class="relative bg-gray-800 rounded-lg p-4 text-white"
				  ><code class="language-SQL">CREATE OR REPLACE TRIGGER Update_Compteur
	  AFTER INSERT ON Reservation
	  FOR EACH ROW
	  BEGIN
		UPDATE CompteurReservations
		SET nombre_reservations = nombre_reservations + 1
		WHERE idHotel = :NEW.idHotel;
	  END;</code></pre>
				</li>
			  </ol>
			  <ol
				type="1"
				id="19963b52-fd00-806b-89bb-e2aa12058a5e"
				class="space-y-2 list-decimal pl-5"
				start="3"
			  >
				<br>
				<li>
				  <strong>Sauvegarder les modifications sur la table Client</strong>
				 
				  <pre
					id="19963b52-fd00-80a3-bb10-c4f6de69274f"
					class="relative bg-gray-800 rounded-lg p-4 text-white"
				  ><code class="language-SQL">CREATE OR REPLACE TRIGGER Backup_Client
	  AFTER UPDATE OR DELETE ON Client
	  FOR EACH ROW
	  BEGIN
		INSERT INTO BackupClient (idClient, nom, prenom, date_modification, action)
		VALUES (:OLD.idClient, :OLD.nom, :OLD.prenom, SYSDATE, CASE WHEN DELETING THEN &#x27;DELETE&#x27; ELSE &#x27;UPDATE&#x27; END);
	  END;</code></pre>
				</li>
			  </ol>
			  <hr id="19963b52-fd00-80c0-b7af-ecc667b6b011" />
        </div>

        <div id="exercises" class="tab-content">
            <h2 class="text-3xl font-bold mb-4">3. Exercices TP Révision BD - Solutions guidées</h2>
            <!-- Content from the exercises section goes here -->
			<h3 id="19963b52-fd00-80f9-a011-f9cd51a5d202" class="">
				<h2 class="text-2xl font-bold mb-4">Gestion des utilisateurs</h2>
			  </h3>
			  <ol
				type="1"
				id="19963b52-fd00-8026-b425-e41020fa28b5"
				class="space-y-2 list-decimal pl-5
				start="1"
			  >
				<br>
				<li>
				  <strong>Créer un utilisateur admin1</strong>
				 
				  <pre
					id="19963b52-fd00-8068-8cb2-d5a7c412c454"
					class="relative bg-gray-800 rounded-lg p-4 text-white"
				  ><code class="language-SQL">CREATE USER admin1 IDENTIFIED BY 12345;
	  GRANT CONNECT TO admin1;</code></pre>
				
				<br>
				<li>
				  <strong>Attribuer les droits à admin1</strong>
				 
				  <pre
					id="19963b52-fd00-8023-bda2-d981a6803f3d"
					class="relative bg-gray-800 rounded-lg p-4 text-white"
				  ><code class="language-SQL">GRANT CREATE TABLE TO admin1;
	  GRANT ALTER (nom, prenom) ON Client TO admin1;
	  GRANT SELECT ON Hotel TO admin1;</code></pre>
				</li>
			  
				<br>
				<li>
				  <strong>Afficher les privilèges</strong>
				 
				  <pre
					id="19963b52-fd00-80b8-8974-da977f20c13c"
					class="relative bg-gray-800 rounded-lg p-4 text-white"
				  ><code class="language-SQL">SELECT * FROM USER_TAB_PRIVS WHERE GRANTEE = &#x27;ADMIN1&#x27;;</code></pre>
				</li>
			  
				<br>
				<li>
				  <strong>Retirer les droits d’admin1</strong>
				 
				  <pre
					id="19963b52-fd00-8071-8188-f4b3022df115"
					class="relative bg-gray-800 rounded-lg p-4 text-white"
				  ><code class="language-SQL">REVOKE ALL PRIVILEGES FROM admin1;</code></pre>
				</li>
			 
				<br>
				<li>
				  <strong>Afficher les utilisateurs existants</strong>
				 
				  <pre
					id="19963b52-fd00-80ca-a478-e74eb3e54cb4"
					class="relative bg-gray-800 rounded-lg p-4 text-white"
				  ><code class="language-SQL">SELECT * FROM DBA_USERS;</code></pre>
				</li>
			 
				<br>
				<li>
				  <strong>Supprimer admin1</strong>
				 
				  <pre
					id="19963b52-fd00-8063-937a-c78b837d8010"
					class="relative bg-gray-800 rounded-lg p-4 text-white"
				  ><code class="language-SQL">DROP USER admin1 CASCADE;</code></pre>
				</li>
			
				<br>
				<li>
				  <strong>Créer user1 avec changement de mot de passe forcé</strong>
				 
				  <pre
					id="19963b52-fd00-8039-a625-f982d27ebf80"
					class="relative bg-gray-800 rounded-lg p-4 text-white"
				  ><code class="language-SQL">CREATE USER user1 IDENTIFIED BY 12345 PASSWORD EXPIRE;</code></pre>
				</li>
			 
				<br>
				<li>
				  <strong>Créer un tablespace et l&#x27;affecter à user1</strong>
				 
				  <pre
					id="19963b52-fd00-80d3-a3ef-d60d89d0a000"
					class="relative bg-gray-800 rounded-lg p-4 text-white"
				  ><code class="language-SQL">CREATE TABLESPACE tab_hotel DATAFILE &#x27;tab_hotel.dbf&#x27; SIZE 4M;
	  ALTER USER user1 DEFAULT TABLESPACE tab_hotel QUOTA 1M ON tab_hotel;</code></pre>
				</li>
			  </ol>
			  <h3 id="19963b52-fd00-80d5-afe2-f315fb019a5c" class="">
				<h2 class="text-2xl font-bold mb-4">PL/SQL</h2>
			  </h3>
			  <ol
				type="1"
				id="19963b52-fd00-80d6-a5cd-eff329f251b4"
				class="space-y-2 list-decimal pl-5
				start="1"
			  >
				<br>
				<li>
				  <strong>Insérer un client en PL/SQL</strong>
				 
				  <pre
					id="19963b52-fd00-8054-a236-c931b3d46e01"
					class="relative bg-gray-800 rounded-lg p-4 text-white"
				  ><code class="language-SQL">BEGIN
		INSERT INTO Client (nom, prenom) VALUES (&#x27;Dupont&#x27;, &#x27;Jean&#x27;);
	  END;</code></pre>
				</li>
			  
				<br>
				<li>
				  <strong>Créer une procédure pour insérer des chambres</strong>
				 
				  <pre
					id="19963b52-fd00-809e-abd9-d19849af6eba"
					class="relative bg-gray-800 rounded-lg p-4 text-white"
				  ><code class="language-SQL">CREATE PROCEDURE Insert_Chambres IS
	  BEGIN
		FOR i IN 1..30 LOOP
		  INSERT INTO Chambre (idChambre, type, tarif, idHotel, libre) VALUES (i, &#x27;Standard&#x27;, 50, 1, &#x27;OUI&#x27;);
		END LOOP;
	  END;</code></pre>
				</li>
			 
				<br>
				<li>
				  <strong>Afficher le total des paiements d’un client</strong>
				 
				  <pre
					id="19963b52-fd00-80fc-bf5e-d7039f0fad73"
					class="relative bg-gray-800 rounded-lg p-4 text-white"
				  ><code class="language-SQL">CREATE FUNCTION TotalPaiements(idClient NUMBER) RETURN NUMBER AS
	  total NUMBER;
	  BEGIN
		SELECT SUM(montant) INTO total FROM Paiement WHERE idClient = idClient;
		RETURN total;
	  END;</code></pre>
				</li>
			  
				<br>
				<li>
				  <strong>Trigger pour empêcher les mises à jour le week-end</strong>
				 
				  <pre
					id="19963b52-fd00-8019-8618-fa8684826d96"
					class="relative bg-gray-800 rounded-lg p-4 text-white"
				  ><code class="language-SQL">CREATE OR REPLACE TRIGGER Bloque_Maj_Weekend
	  BEFORE UPDATE ON Reservation
	  FOR EACH ROW
	  BEGIN
		IF TO_CHAR(SYSDATE, &#x27;DY&#x27;) IN (&#x27;SAT&#x27;, &#x27;SUN&#x27;) THEN
		  RAISE_APPLICATION_ERROR(-20001, &#x27;Mise à jour interdite&#x27;);
		END IF;
	  END;</code></pre>
				</li>
			  </ol>
			  <hr id="19963b52-fd00-809f-911d-df2de554fdbf" />
			  <h3 id="19963b52-fd00-8012-8feb-e0bb99802327" class="">
        </div>
    </main>

    <!-- Prism JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-sql.min.js"></script>
	<script src="prism.js"></script>
    
    <script>
        // Tab switching
        document.querySelectorAll('[data-tab]').forEach(button => {
            button.addEventListener('click', () => {
                // Update button states
                document.querySelectorAll('[data-tab]').forEach(btn => {
                    btn.classList.remove('border-blue-500', 'text-blue-600');
                    btn.classList.add('text-gray-500');
                });
                button.classList.add('border-blue-500', 'text-blue-600');
                button.classList.remove('text-gray-500');

                // Update content visibility
                document.querySelectorAll('.tab-content').forEach(content => {
                    content.classList.remove('active');
                });
                document.getElementById(button.dataset.tab).classList.add('active');
            });
        });

        // Copy functionality
        document.querySelectorAll('pre').forEach(block => {
            const button = document.createElement('button');
            button.className = 'copy-button';
            button.textContent = 'Copy';
            
            block.appendChild(button);
            
            button.addEventListener('click', async () => {
                const code = block.querySelector('code');
                try {
                    await navigator.clipboard.writeText(code.textContent);
                    button.textContent = 'Copied!';
                    button.classList.add('copied');
                    setTimeout(() => {
                        button.textContent = 'Copy';
                        button.classList.remove('copied');
                    }, 2000);
                } catch (err) {
                    console.error('Failed to copy:', err);
                    button.textContent = 'Error';
                }
            });
        });
    </script>
</body>
</html>